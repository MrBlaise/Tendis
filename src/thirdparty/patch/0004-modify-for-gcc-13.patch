From 7bbebbf619d5567917fbd876e767dd982f2e1733 Mon Sep 17 00:00:00 2001
From: raffertyyu <raffertyyu@tencent.com>
Date: Mon, 8 May 2023 15:33:59 +0800
Subject: [PATCH] fix compile error using gcc-13

---
 db/compaction/compaction_iteration_stats.h                  | 2 ++
 db/db_impl/db_impl.cc                                       | 6 +++---
 include/rocksdb/utilities/checkpoint.h                      | 1 +
 table/block_based/data_block_hash_index.h                   | 1 +
 table/plain/plain_table_builder.cc                          | 2 +-
 .../folly/folly/synchronization/detail/ProxyLockable-inl.h  | 1 +
 trace_replay/trace_replay.cc                                | 2 +-
 util/string_util.h                                          | 1 +
 8 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/db/compaction/compaction_iteration_stats.h b/db/compaction/compaction_iteration_stats.h
index cb7b82c65..226c22b1c 100644
--- a/db/compaction/compaction_iteration_stats.h
+++ b/db/compaction/compaction_iteration_stats.h
@@ -5,6 +5,8 @@
 
 #pragma once
 
+#include <cstdint>
+
 #include "rocksdb/rocksdb_namespace.h"
 
 struct CompactionIterationStats {
diff --git a/db/db_impl/db_impl.cc b/db/db_impl/db_impl.cc
index 482c2a3f1..00de6221c 100644
--- a/db/db_impl/db_impl.cc
+++ b/db/db_impl/db_impl.cc
@@ -1295,11 +1295,11 @@ Status DBImpl::FlushWAL(bool sync) {
       // future writes
       IOStatusCheck(io_s);
       // whether sync or not, we should abort the rest of function upon error
-      return std::move(io_s);
+      return io_s;
     }
     if (!sync) {
       ROCKS_LOG_DEBUG(immutable_db_options_.info_log, "FlushWAL sync=false");
-      return std::move(io_s);
+      return io_s;
     }
   }
   if (!sync) {
@@ -1396,7 +1396,7 @@ Status DBImpl::LockWAL() {
     // future writes
     WriteStatusCheck(status);
   }
-  return std::move(status);
+  return status;
 }
 
 Status DBImpl::UnlockWAL() {
diff --git a/include/rocksdb/utilities/checkpoint.h b/include/rocksdb/utilities/checkpoint.h
index df2a74403..47e4820db 100644
--- a/include/rocksdb/utilities/checkpoint.h
+++ b/include/rocksdb/utilities/checkpoint.h
@@ -8,6 +8,7 @@
 #pragma once
 #ifndef ROCKSDB_LITE
 
+#include <cstdint>
 #include <string>
 #include <vector>
 #include "rocksdb/status.h"
diff --git a/table/block_based/data_block_hash_index.h b/table/block_based/data_block_hash_index.h
index f356395f3..321522175 100644
--- a/table/block_based/data_block_hash_index.h
+++ b/table/block_based/data_block_hash_index.h
@@ -5,6 +5,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <string>
 #include <vector>
 
diff --git a/table/plain/plain_table_builder.cc b/table/plain/plain_table_builder.cc
index 5754f7c29..3992319ab 100644
--- a/table/plain/plain_table_builder.cc
+++ b/table/plain/plain_table_builder.cc
@@ -273,7 +273,7 @@ Status PlainTableBuilder::Finish() {
   IOStatus s = WriteBlock(property_block_builder.Finish(), file_, &offset_,
                           &property_block_handle);
   if (!s.ok()) {
-    return std::move(s);
+    return s;
   }
   meta_index_builer.Add(kPropertiesBlock, property_block_handle);
 
diff --git a/third-party/folly/folly/synchronization/detail/ProxyLockable-inl.h b/third-party/folly/folly/synchronization/detail/ProxyLockable-inl.h
index 573330ceb..ada1e63d4 100644
--- a/third-party/folly/folly/synchronization/detail/ProxyLockable-inl.h
+++ b/third-party/folly/folly/synchronization/detail/ProxyLockable-inl.h
@@ -14,6 +14,7 @@
 #include <mutex>
 #include <stdexcept>
 #include <utility>
+#include <system_error>
 
 namespace folly {
 namespace detail {
diff --git a/trace_replay/trace_replay.cc b/trace_replay/trace_replay.cc
index 5fd529568..81bbd233d 100644
--- a/trace_replay/trace_replay.cc
+++ b/trace_replay/trace_replay.cc
@@ -217,7 +217,7 @@ void TracerHelper::DecodeMultiGetPayload(Trace* trace,
   multiget_payload->cf_ids.reserve(multiget_payload->multiget_size);
   multiget_payload->multiget_keys.reserve(multiget_payload->multiget_size);
   for (uint32_t i = 0; i < multiget_payload->multiget_size; i++) {
-    uint32_t tmp_cfid;
+    uint32_t tmp_cfid = 0;
     Slice tmp_key;
     GetFixed32(&cfids_payload, &tmp_cfid);
     GetLengthPrefixedSlice(&keys_payload, &tmp_key);
diff --git a/util/string_util.h b/util/string_util.h
index 195ae8b0b..9fa47f8b9 100644
--- a/util/string_util.h
+++ b/util/string_util.h
@@ -6,6 +6,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <sstream>
 #include <string>
 #include <unordered_map>
-- 
2.40.1

